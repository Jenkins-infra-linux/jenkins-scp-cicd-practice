# jenkins-scp-cicd-practice

<br>

## ğŸ¤ Team Members
| <img src="https://github.com/kcklkb.png" width="200px"> | <img src="https://github.com/woody6624.png" width="200px"> | <img src="https://github.com/parkjhhh.png" width="200px"> | <img src="https://github.com/unoYoon.png" width="200px"> |
| :---: | :---: | :---: | :---: |
| [ê¹€ì°½ê·œ](https://github.com/kcklkb) | [ê¹€ìš°í˜„](https://github.com/woody6624) | [ë°•ì§€í˜œ](https://github.com/parkjhhh) | [ìœ¤ì›í˜¸](https://github.com/unoYoon) |

<br>

## ğŸš€í”„ë¡œì íŠ¸ ê°œìš”

GitHubì˜ ìˆ˜ì •ëœ ê°’ì´ ìˆì„ ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ íŒŒì´í”„ë¼ì¸ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´, 

GitHub Webhookì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ Ngrokì„ í†µí•´ Jenkins ì„œë²„ë¥¼ ì™¸ë¶€ì— ë…¸ì¶œì‹œí‚¤ê³ , 

GitHub Webhookì´ ì´ë¥¼ íŠ¸ë¦¬ê±°í•˜ì—¬ Jenkins ë¹Œë“œê°€ ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.

Ngrokì„ ì‚¬ìš©í•˜ë©´ ë¡œì»¬ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ Jenkins ì„œë²„ì— ì™¸ë¶€ ì ‘ê·¼ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. 

ì´ë¥¼ í†µí•´ GitHubì—ì„œ ì½”ë“œ ìˆ˜ì • ì‹œ ì‹¤ì‹œê°„ìœ¼ë¡œ ìë™ ë¹Œë“œ ë° ë°°í¬ê°€ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

<br>

## ğŸ”„í”„ë¡œì íŠ¸ ëª©ì 

- ì´ í”„ë¡œì íŠ¸ëŠ” Jenkins í™˜ê²½ì—ì„œ íš¨ìœ¨ì ì¸ CI/CD íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•˜ì—¬ ê°œë°œ ë° ë°°í¬ ì†ë„ë¥¼ ê·¹ëŒ€í™”í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.


- ìë™í™”ëœ ë¹Œë“œ ë° ë°°í¬ë¥¼ í†µí•´ ìš´ì˜ ë¹„ìš© ì ˆê°ê³¼ ì•ˆì •ì ì¸ ì„œë¹„ìŠ¤ ì œê³µì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.


- GitHub Webhookê³¼ Jenkinsë¥¼ í™œìš©í•´ ê°œë°œ ë³€ê²½ ì‚¬í•­ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì˜í•˜ì—¬ ì§€ì†ì ì¸ ë°°í¬ í™˜ê²½ì„ êµ¬ì¶•í•©ë‹ˆë‹¤. 


<br>

## ğŸ“„í”„ë¡œì íŠ¸ ê³¼ì •

<br>


### ngrokì„ í†µí•´ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ í™˜ê²½ì„ êµ¬ì„±

<br>


![image](https://github.com/user-attachments/assets/9034f785-f0d0-4cbe-aea1-5257672f5eb8)

<br>

### GitHub Webhook, ì €ì¥ì†Œì—ì„œ ë°œìƒí•œ ì´ë²¤íŠ¸ ì™¸ë¶€ ì„œë²„ë¡œ ìë™ ì „ë‹¬

<br>

![image](https://github.com/user-attachments/assets/7bdacf38-bc87-4727-a544-58a96351d1d6)



### Github hook trigger for GITScm polling ì„¤ì •

<br>


![image](https://github.com/user-attachments/assets/cff6ab08-18a2-424d-8849-814d1fe548a2)

GitHub Webhookì„ í†µí•´ ì½”ë“œ ë³€ê²½ ì‚¬í•­ì´ ìˆì„ ë•Œ 

Jenkinsê°€ ì¦‰ì‹œ ë¹Œë“œë¥¼ íŠ¸ë¦¬ê±°í•˜ë„ë¡ í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.

<br>

### 1. Jenkins í™˜ê²½ ì„¤ì •

Jenkinsë¥¼ Docker ì»¨í…Œì´ë„ˆì—ì„œ ì‹¤í–‰í•  ê²½ìš°, ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ SSH í‚¤ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

```
docker exec -it <container ID> bash
ssh-keygen -t rsa -b 4096
ls -l .ssh
cat .ssh/authorized_keys
cat .ssh/id_rsa
cat .ssh/id_rsa.pub
ssh-copy-id ubuntu@10.0.2.20
ssh ubuntu@myserver02  # ë¹„ë°€ë²ˆí˜¸ ì—†ì´ ì ‘ì†ë˜ëŠ”ì§€ í™•ì¸
```

### 2. íŒŒì¼ ì „ì†¡ í…ŒìŠ¤íŠ¸

ì„œë²„ ê°„ íŒŒì¼ ì „ì†¡ì´ ì •ìƒì ìœ¼ë¡œ ì´ë£¨ì–´ì§€ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

```
scp ë³µì‚¬í• íŒŒì¼ username@remote_server_ip:/ë³µì‚¬ë°›ì„ê²½ë¡œ
```

### 3. íŒŒì¼ ë³€ê²½ ëª¨ë‹ˆí„°ë§

server01ì—ì„œ íŠ¹ì • íŒŒì¼ì´ ìˆ˜ì •ë˜ì—ˆëŠ”ì§€ ì‹¤ì‹œê°„ìœ¼ë¡œ ê°ì§€í•©ë‹ˆë‹¤.

```
inotifywait -m -e close_write $(pwd)/
```

### 4. Jenkins CI/CD Pipeline

Jenkinsfileì„ ì´ìš©í•˜ì—¬ ìë™ ë¹Œë“œ ë° ë°°í¬ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

```
pipeline {
    agent any

    stages {
        stage('Clone Repository') {
            steps {
                git branch: 'main', url: 'https://github.com/UnoYoon/20250324a.git'
            }
        }
        stage('Build') {
            steps {
                dir('step07_cicd') {
                    sh 'chmod +x gradlew'
                    sh './gradlew clean build -x test'
                }
            }
        }
        stage('Copy jar') {
            steps {
                script {
                    sh 'cp step07_cicd/build/libs/step07_cicd-0.0.1-SNAPSHOT.jar /var/jenkins_home/appjar/'
                }
            }
        }
        stage('Transfer to Server B') {
            steps {
                script {
                    sh 'scp /var/jenkins_home/appjar/step07_cicd-0.0.1-SNAPSHOT.jar wonho@10.0.2.20:/home/jihye/bind/'
                }
            }
        }
        stage('Restart Application on Server B') {
            steps {
                script {
                    sh 'ssh jihye2@10.0.2.20 "bash /home/jihye/bind/restart.sh"'
                }
            }
        }
    }
}
```


### 5. ìë™ ë°°í¬ ë° ì¬ì‹œì‘


ì„œë²„ Bë¡œ íŒŒì¼ì„ ì „ì†¡ í›„, ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì¬ì‹œì‘í•©ë‹ˆë‹¤.


```
ssh wonho@10.0.2.16 "bash /home/wonho/bind/restart.sh"
```


ì´ ê³¼ì •ì„ í†µí•´ GitHub ì½”ë“œ ë³€ê²½ â†’ Jenkins ë¹Œë“œ â†’ ì„œë²„ B ë°°í¬ â†’ ì• í”Œë¦¬ì¼€ì´ì…˜ 

ìë™ ì¬ì‹œì‘ê¹Œì§€ì˜ CI/CD íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶• ì™„ë£Œí•˜ì˜€ìŠµë‹ˆë‹¤.

<br>

## ğŸ› ï¸ Troubleshooting



### ë¬¸ì œ ìƒí™©1 : SSH ì ‘ì† ì‹œ ë¹„ë°€ë²ˆí˜¸ ìš”ì²­ ë¬¸ì œ
<br>

ì›ê²© ì„œë²„ myserver01ì—ì„œ myserver02ë¡œ SSH ì ‘ì† ì‹œ, ì •ìƒì ìœ¼ë¡œ ì„¤ì •ëœ SSH í‚¤ê°€ ìˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³  ë¹„ë°€ë²ˆí˜¸ë¥¼ ê³„ì†í•´ì„œ ìš”êµ¬í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.

```
ssh ubuntu@myserver02 # ì›ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ ì—†ì´ ì ‘ì†ë˜ì–´ì•¼ í•¨
```

<br>

### ì›ì¸ ë¶„ì„

ì›ê²© ì„œë²„(myserver02)ì˜ í™ˆ ë””ë ‰í„°ë¦¬(~) ê¶Œí•œì´ ì˜ëª» ì„¤ì •ë˜ì–´ SSH ì¸ì¦ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

SSHëŠ” ë³´ì•ˆìƒ í™ˆ ë””ë ‰í„°ë¦¬ì˜ ê¶Œí•œì´ ë„ˆë¬´ ë„“ê±°ë‚˜ ì˜ëª»ëœ ê²½ìš° ì¸ì¦ì„ ê±°ë¶€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<br>

### í•´ê²° ë°©ë²•

myserver02ì—ì„œ í™ˆ ë””ë ‰í„°ë¦¬(~)ì˜ ê¶Œí•œì„ 755ë¡œ ìˆ˜ì •í•˜ì—¬ SSH í‚¤ ì¸ì¦ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ë„ë¡ í•©ë‹ˆë‹¤.

```
chmod 755 ~  # í™ˆ ë””ë ‰í„°ë¦¬ ê¶Œí•œ ë³€ê²½
```

<br>

### ê²°ê³¼

SSH ì ‘ì† ì‹œ ë” ì´ìƒ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë¬»ì§€ ì•Šê³  ì •ìƒì ìœ¼ë¡œ ë¡œê·¸ì¸ë©ë‹ˆë‹¤.

SSH í‚¤ ê¸°ë°˜ ì¸ì¦ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ì—¬ ìë™í™” ë°°í¬ ê³¼ì •ì—ì„œ ë¬¸ì œ ë°œìƒ ê°€ëŠ¥ì„±ì´ ì¤„ì–´ë“¤ì—ˆìŠµë‹ˆë‹¤.


---
### ë¬¸ì œ ìƒí™©2 : myserver01(Unbuntu)ì— ì§ì ‘ ì„¤ì¹˜ë˜ì–´ìˆëŠ” Jenkins ì•„ì´ë”” ë¹„ë°€ë²ˆí˜¸ ìŠì–´ë²„ë ¸ì„ë•Œ 
<br>


### í•´ê²° ë°©ë²•
vi í¸ì§‘ê¸°ë¥¼ ì´ìš©í•´ì„œ xmlíŒŒì¼ ë‚´ìš©ì— useSecurityë¶€ë¶„ì„ falseë¡œ ë³€ê²½

![troubleshooting1](https://github.com/user-attachments/assets/6d646132-c9d4-4dbc-a646-e74ea2f31398)

```
jihye@myserver01:~$ vi /var/lib/jenkins/config.xml
```

<br>

### ê²°ê³¼

ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì§€ì•Šì•„ë„ ë°”ë¡œ Jenkins Dashboard ì°½ìœ¼ë¡œ ì´ë™<br>
ì´ ë‚´ë¶€ì—ì„œ ì•„ì´ë”” í™•ì¸
